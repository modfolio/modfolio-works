---
const user = Astro.locals.user;

const apps = [
	{
		id: "naviaca",
		name: "Naviaca",
		desc: "학원 CRM + LMS + SIS",
		domain: "naviaca.com",
		url: "https://app.naviaca.com",
		status: "active" as const,
		accent: "#8EC8E0",
	},
	{
		id: "gistcore",
		name: "GistCore",
		desc: "AI 스피킹 연습",
		domain: "gistcore.com",
		url: "https://app.gistcore.com",
		status: "active" as const,
		accent: "#8AE0CC",
	},
	{
		id: "fortiscribe",
		name: "Fortiscribe",
		desc: "AI 작문 첨삭",
		domain: "fortiscribe.com",
		url: "https://app.fortiscribe.com",
		status: "landing" as const,
		accent: "#FFD97A",
	},
];
---

<html lang="ko">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>{user ? "포털 — Modfolio Works" : "Modfolio Works"}</title>
	<meta name="description" content="교육 그룹 — Naviaca, GistCore, Fortiscribe" />
	<link rel="stylesheet" href="https://use.typekit.net/auk2qdl.css" />
	<link rel="preconnect" href="https://fonts.googleapis.com" />
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
	<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@400;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet" />
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable-dynamic-subset.min.css" />
	<style>
		:root {
			--bg: #0A0A0F; --surface: #13131A; --surface2: #1C1C26;
			--text: #EDE8F0; --text2: #A09AAC;
			--a1: #8EC8E0; --a2: #8AE0CC;
			--border: rgba(255,255,255,0.05); --border-hover: rgba(255,255,255,0.12);
			--magic-heading: "goldenbook", "Noto Serif KR", serif;
			--poetic-quote: "mrs-eaves-roman", "Noto Serif KR", serif;
			--storybook-body: "adobe-caslon-pro", "Noto Serif KR", serif;
			--warm-tech: "brandon-grotesque", "Pretendard", sans-serif;
			--clear-data: "proxima-nova", "Pretendard", sans-serif;
		}
		* { margin:0; padding:0; box-sizing:border-box; }
		body { font-family:var(--storybook-body); background:var(--bg); color:var(--text); min-height:100vh; }
		.glow { position:fixed; width:600px; height:600px; border-radius:50%; filter:blur(120px); opacity:0.06; pointer-events:none; }
		.glow-1 { background:var(--a1); top:-200px; right:-200px; }
		.glow-2 { background:var(--a2); bottom:-200px; left:-200px; }

		/* Landing (unauthenticated) */
		.landing { display:flex; flex-direction:column; align-items:center; justify-content:center; min-height:100vh; text-align:center; padding:2rem; position:relative; z-index:1; }
		.landing h1 { font-family:var(--magic-heading); font-size:clamp(2.5rem,8vw,5rem); font-weight:700; background:linear-gradient(135deg,var(--a1),var(--a2)); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; margin-bottom:1rem; letter-spacing:-0.02em; }
		.landing .tagline { font-family:var(--poetic-quote); font-size:clamp(1rem,3vw,1.5rem); font-style:italic; margin-bottom:0.5rem; }
		.landing .desc { font-size:clamp(0.875rem,2vw,1.125rem); color:var(--text2); max-width:40ch; margin:0 auto 2rem; line-height:1.6; }
		.btn-login { display:inline-flex; align-items:center; gap:0.5rem; padding:0.875rem 2rem; background:linear-gradient(135deg,var(--a1),var(--a2)); border:none; border-radius:8px; color:var(--bg); font-family:var(--warm-tech); font-size:1rem; font-weight:600; cursor:pointer; text-decoration:none; transition:opacity 0.2s; }
		.btn-login:hover { opacity:0.9; }

		/* Portal (authenticated) */
		.portal { max-width:960px; margin:0 auto; padding:3rem 1.5rem; position:relative; z-index:1; }
		.portal-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:2.5rem; }
		.portal-header h1 { font-family:var(--magic-heading); font-size:1.75rem; font-weight:700; }
		.portal-header .user-info { display:flex; align-items:center; gap:1rem; font-family:var(--clear-data); font-size:0.875rem; color:var(--text2); }
		.btn-logout { padding:0.5rem 1rem; border:1px solid var(--border); border-radius:6px; background:transparent; color:var(--text2); font-family:var(--clear-data); font-size:0.75rem; cursor:pointer; text-decoration:none; transition:border-color 0.2s; }
		.btn-logout:hover { border-color:var(--border-hover); color:var(--text); }

		.card-grid { display:grid; grid-template-columns:repeat(auto-fill, minmax(280px, 1fr)); gap:1.25rem; }
		.card { background:var(--surface); border:1px solid var(--border); border-radius:16px; padding:1.75rem; transition:transform 0.2s, border-color 0.2s; cursor:default; }
		.card:hover { transform:translateY(-2px); border-color:var(--border-hover); }
		.card-top { display:flex; align-items:center; gap:0.75rem; margin-bottom:1rem; }
		.dot { width:10px; height:10px; border-radius:50%; flex-shrink:0; }
		.card-name { font-family:var(--magic-heading); font-size:1.25rem; font-weight:700; }
		.card-desc { font-family:var(--storybook-body); font-size:0.9375rem; color:var(--text2); line-height:1.5; margin-bottom:1.25rem; }
		.card-footer { display:flex; justify-content:space-between; align-items:center; }
		.card-domain { font-family:var(--clear-data); font-size:0.75rem; color:var(--text2); }
		.card-status { font-family:var(--clear-data); font-size:0.6875rem; text-transform:uppercase; letter-spacing:0.05em; padding:0.25rem 0.625rem; border-radius:999px; }
		.status-active { background:rgba(138,224,204,0.12); color:#8AE0CC; }
		.status-landing { background:rgba(255,217,122,0.12); color:#FFD97A; }
		.card-link { display:inline-flex; align-items:center; gap:0.375rem; font-family:var(--warm-tech); font-size:0.875rem; font-weight:600; color:var(--text); text-decoration:none; margin-top:1rem; transition:color 0.2s; }
		.card-link:hover { color:var(--a1); }
	</style>
</head>
<body>
	<div class="glow glow-1"></div>
	<div class="glow glow-2"></div>

	{user ? (
		<main class="portal">
			<header class="portal-header">
				<h1>Works Portal</h1>
				<div class="user-info">
					<span>{user.email}</span>
					<a href="/auth/logout" class="btn-logout">로그아웃</a>
				</div>
			</header>
			<div class="card-grid">
				{apps.map((app) => (
					<div class="card">
						<div class="card-top">
							<div class="dot" style={`background:${app.accent}`}></div>
							<span class="card-name">{app.name}</span>
						</div>
						<p class="card-desc">{app.desc}</p>
						<div class="card-footer">
							<span class="card-domain">{app.domain}</span>
							<span class={`card-status ${app.status === "active" ? "status-active" : "status-landing"}`}>
								{app.status === "active" ? "Active" : "준비 중"}
							</span>
						</div>
						{app.status === "active" ? (
							<a href={app.url} class="card-link" target="_blank" rel="noopener">
								앱 열기 &rarr;
							</a>
						) : (
							<span class="card-link" style="color:var(--text2);cursor:default;">준비 중</span>
						)}
					</div>
				))}
			</div>
		</main>
	) : (
		<main class="landing">
			<h1>Modfolio Works</h1>
			<p class="tagline">Education</p>
			<p class="desc">교육 그룹 — Naviaca, GistCore, Fortiscribe</p>
			<a href="/auth/login" class="btn-login">Modfolio Connect로 로그인</a>
		</main>
	)}
</body>
</html>
